# Notion ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ

Notion é£æ ¼çš„ä»»åŠ¡ç½‘æ ¼è§†å›¾ï¼Œå¸¦æœ‰ Node.js + Express åç«¯é›†æˆ Notion APIã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… ä» Notion æ•°æ®åº“è·å–ä»»åŠ¡åˆ—è¡¨
- âœ… åˆ›å»ºæ–°ä»»åŠ¡å¹¶åŒæ­¥åˆ° Notion
- âœ… æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
- âœ… æ›´æ–°ä»»åŠ¡çŠ¶æ€ï¼ˆå®æ—¶åŒæ­¥ï¼‰
- âœ… 20ç§’è‡ªåŠ¨è½®è¯¢åˆ·æ–°
- âœ… Notion Token ä»…åœ¨æœåŠ¡ç«¯ï¼Œä¸æ³„éœ²åˆ°æµè§ˆå™¨

## å‰ç½®è¦æ±‚

- **Node.js** (æ¨è v18 æˆ–æ›´é«˜ç‰ˆæœ¬)
- **Notion è´¦æˆ·**ï¼Œå¹¶å®Œæˆä»¥ä¸‹è®¾ç½®ï¼š

### å¦‚ä½•è·å– Notion Integration Token

> **é‡è¦**: å¿…é¡»ä½¿ç”¨ Notion Integration çš„ "Internal Integration Secret"ï¼Œä¸æ˜¯æ™®é€šçš„ API Key æˆ–æ•°æ®åº“å±æ€§ï¼

1. **åˆ›å»º Integration**
   - è®¿é—® https://www.notion.so/my-integrations
   - ç‚¹å‡» "+ New integration"
   - å¡«å†™åç§°ï¼ˆä¾‹å¦‚ï¼š"Task Manager"ï¼‰
   - é€‰æ‹©å…³è”çš„ Workspace
   - ç‚¹å‡» "Submit"

2. **å¤åˆ¶ Integration Secret**
   - åœ¨ Integration é¡µé¢ï¼Œæ‰¾åˆ° "Internal Integration Secret"
   - ç‚¹å‡» "Show" ç„¶å "Copy"
   - è¿™å°±æ˜¯ä½ çš„ `NOTION_TOKEN`ï¼ˆæ ¼å¼ï¼š`secret_xxx...`ï¼‰
   - **æ³¨æ„**: è¿™ä¸ª token ä»¥ `secret_` å¼€å¤´ï¼Œé•¿åº¦é€šå¸¸æ˜¯ 50 å­—ç¬¦å·¦å³

3. **åˆ›å»ºæ•°æ®åº“å¹¶è®¾ç½®å±æ€§**
   - åœ¨ Notion ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ Databaseï¼ˆFull page æˆ– Inline éƒ½å¯ä»¥ï¼‰
   - ç¡®ä¿æ•°æ®åº“åŒ…å«ä»¥ä¸‹å±æ€§ï¼š
     - **æ ‡é¢˜** (Title ç±»å‹) - è¿™æ˜¯æ•°æ®åº“çš„é»˜è®¤ title å±æ€§
     - **çŠ¶æ€** (Status ç±»å‹) - åˆ›å»ºä¸€ä¸ª Status å±æ€§ï¼Œåç§°å¿…é¡»æ˜¯ "çŠ¶æ€"
   - åœ¨ "çŠ¶æ€" å±æ€§ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹ 5 ä¸ªé€‰é¡¹ï¼ˆStatus optionsï¼‰ï¼š
     - `å¾…è·Ÿè¿›`
     - `è®¡åˆ’ä¸­`
     - `ä¸¢å¼ƒ`
     - `æç½®`
     - `å·²è§£å†³`
   - **é‡è¦**: åˆ†ç»„æ ‡é¢˜ï¼ˆå¦‚"å¾…åŠ"ã€"è¿›è¡Œä¸­"ã€"å·²å®Œæˆ"ï¼‰æ˜¯ Notion UI çš„æ˜¾ç¤ºåˆ†ç»„ï¼Œä¸è¦ä½œä¸ºå®é™…çŠ¶æ€å€¼

4. **åˆ†äº«æ•°æ®åº“ç»™ Integration**
   - æ‰“å¼€ä½ åˆ›å»ºçš„æ•°æ®åº“
   - ç‚¹å‡»å³ä¸Šè§’ "..." â†’ "Add connections"
   - æœç´¢å¹¶é€‰æ‹©ä½ åˆšåˆ›å»ºçš„ Integration
   - ç‚¹å‡» "Confirm"

5. **è·å–æ•°æ®åº“ ID**
   - æ‰“å¼€æ•°æ®åº“é¡µé¢
   - ä» URL ä¸­å¤åˆ¶æ•°æ®åº“ ID
   - URL æ ¼å¼ï¼š`https://www.notion.so/[workspace]/[DATABASE_ID]?v=...`
   - æ•°æ®åº“ ID æ˜¯ä¸€ä¸ª 32 å­—ç¬¦çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆä¸åŒ…å«è¿å­—ç¬¦çš„ç‰ˆæœ¬ï¼‰
   - ä¾‹å¦‚ï¼š`2ac17f7c53018168890cc34d3ac24e55`

### æµ‹è¯• Token æ˜¯å¦æœ‰æ•ˆ

å¯åŠ¨æœåŠ¡å™¨åï¼Œè®¿é—®è°ƒè¯•ç«¯ç‚¹ï¼š

```bash
curl http://localhost:3001/api/debug/notion-auth
```

- **æˆåŠŸ**: è¿”å› `{ "success": true, "message": "âœ… Notion authentication successful!", ... }`
- **401 é”™è¯¯**: Token æ— æ•ˆï¼Œè¯·é‡æ–°å¤åˆ¶ Internal Integration Secret
- **403 é”™è¯¯**: æ•°æ®åº“æœªåˆ†äº«ç»™ Integrationï¼Œè¯·æ‰§è¡Œæ­¥éª¤ 4

## ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `server/` ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå‚è€ƒ `server/.env.example`ï¼‰ï¼š

```bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp server/.env.example server/.env

# ç¼–è¾‘ server/.env å¹¶å¡«å…¥ä»¥ä¸‹ä¿¡æ¯ï¼š
NOTION_TOKEN=secret_your_notion_integration_token_here
NOTION_DATABASE_ID=your_database_id_here
PORT=3001  # å¯é€‰ï¼Œé»˜è®¤ 3001
```

## å®‰è£…ä¾èµ–

```bash
# å®‰è£…å‰ç«¯ä¾èµ–
npm install

# å®‰è£…åç«¯ä¾èµ–
cd server && npm install && cd ..
```

## æœ¬åœ°å¼€å‘

```bash
# ä¸€æ¡å‘½ä»¤åŒæ—¶å¯åŠ¨å‰ç«¯ï¼ˆç«¯å£3000ï¼‰+ åç«¯ï¼ˆç«¯å£3001ï¼‰
npm run dev
```

è®¿é—® http://localhost:3000 å³å¯æŸ¥çœ‹åº”ç”¨ã€‚

## éªŒè¯åŠŸèƒ½

### 1. æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨
- æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:3000
- åº”è¯¥èƒ½çœ‹åˆ°ä» Notion æ•°æ®åº“è·å–çš„ä»»åŠ¡å¡ç‰‡
- æ‰“å¼€å¼€å‘è€…å·¥å…· Network é€‰é¡¹å¡ï¼Œç¡®è®¤æœ‰ `GET /api/tasks` è¯·æ±‚

### 2. åˆ›å»ºæ–°ä»»åŠ¡
- ç‚¹å‡»é¡µé¢ä¸­çš„ **"+ æ–°ä»»åŠ¡"** æŒ‰é’®ï¼ˆæˆ–å³ä¸‹è§’æµ®åŠ¨æŒ‰é’®ï¼‰
- æ–°ä»»åŠ¡ä¼šç«‹å³åˆ›å»ºå¹¶æ˜¾ç¤ºåœ¨åˆ—è¡¨é¡¶éƒ¨
- æ‰“å¼€ Notion æ•°æ®åº“ï¼Œç¡®è®¤æ–°ä»»åŠ¡å·²åŒæ­¥

### 3. æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
- ç‚¹å‡»ä»»æ„ä»»åŠ¡å¡ç‰‡
- å³ä¾§æŠ½å±‰æ‰“å¼€ï¼Œæ˜¾ç¤ºä»»åŠ¡è¯¦æƒ…
- Network é€‰é¡¹å¡åº”æ˜¾ç¤º `GET /api/tasks/:id` è¯·æ±‚

### 4. æ›´æ–°ä»»åŠ¡çŠ¶æ€
- åœ¨è¯¦æƒ…æŠ½å±‰ä¸­ï¼Œç‚¹å‡» **"å¤„ç†çŠ¶æ€"** ä¸‹æ‹‰èœå•
- é€‰æ‹©ä¸€ä¸ªæ–°çš„çŠ¶æ€ï¼ˆå¦‚ï¼š`è®¡åˆ’ä¸­` â†’ `å·²è§£å†³`ï¼‰
- å…³é—­æŠ½å±‰ï¼Œç¡®è®¤ä»»åŠ¡å¡ç‰‡ä¸Šçš„çŠ¶æ€å·²æ›´æ–°
- æ‰“å¼€ Notion æ•°æ®åº“ï¼Œç¡®è®¤çŠ¶æ€å·²åŒæ­¥

### 5. è‡ªåŠ¨è½®è¯¢åˆ·æ–°
- åœ¨ Notion æ•°æ®åº“ä¸­æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€æˆ–æ ‡é¢˜
- ç­‰å¾…æœ€å¤š 20 ç§’ï¼Œå‰ç«¯ä¼šè‡ªåŠ¨åˆ·æ–°å¹¶æ˜¾ç¤ºæœ€æ–°æ•°æ®

## æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
# æ„å»ºå‰ç«¯
npm run build

# æ„å»ºåç«¯
npm run build:server

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨ï¼ˆéœ€å…ˆé…ç½®ç¯å¢ƒå˜é‡ï¼‰
cd server && npm start
```

## éƒ¨ç½²æŒ‡å—

### Vercel (æ¨èå‰ç«¯)

1. å‰ç«¯éƒ¨ç½²åˆ° Vercel:
   - è¿æ¥ GitHub ä»“åº“
   - Build Command: `npm run build`
   - Output Directory: `dist`

2. åç«¯éƒ¨ç½²åˆ°å…¶ä»–å¹³å°ï¼ˆè§ä¸‹æ–¹ï¼‰

### Railway / Render (æ¨èåç«¯)

1. åˆ›å»ºæ–°çš„ Node.js æœåŠ¡
2. è¿æ¥ GitHub ä»“åº“ï¼Œè®¾ç½® Root Directory ä¸º `server`
3. é…ç½®ç¯å¢ƒå˜é‡:
   - `NOTION_TOKEN`
   - `NOTION_DATABASE_ID`
   - `PORT` (å¯é€‰)
4. Build Command: `npm install && npm run build`
5. Start Command: `npm start`
6. éƒ¨ç½²æˆåŠŸåï¼Œå°†åç«¯ URL æ›´æ–°åˆ°å‰ç«¯ç¯å¢ƒå˜é‡ `VITE_API_BASE_URL`

### ä¸€ä½“åŒ–éƒ¨ç½² (Render å…¨æ ˆ)

å¯ä»¥åœ¨ Render ä¸Šéƒ¨ç½²æ•´ä¸ªåº”ç”¨ï¼ˆå‰ç«¯+åç«¯ï¼‰ï¼š

1. åˆ›å»ºä¸€ä¸ª Web Service
2. Build Command: `npm install && cd server && npm install && cd .. && npm run build && npm run build:server`
3. Start Command: `cd server && npm start`
4. åœ¨åŒä¸€æœåŠ¡çš„é™æ€æ–‡ä»¶è®¾ç½®ä¸­ï¼Œå°† `/dist` ç›®å½•è®¾ä¸ºé™æ€èµ„æº
5. é…ç½®ç¯å¢ƒå˜é‡

## API æ¥å£æ–‡æ¡£

### GET /api/tasks
è·å–æ‰€æœ‰ä»»åŠ¡åˆ—è¡¨

**å“åº”ç¤ºä¾‹:**
```json
[
  {
    "id": "page-id-1",
    "title": "ä»»åŠ¡æ ‡é¢˜",
    "status": "è®¡åˆ’ä¸­",
    "updatedAt": "2024-01-12T10:00:00.000Z",
    "type": "ä»»åŠ¡",
    "color": "#3b82f6",
    "icon": "check_circle"
  }
]
```

### GET /api/tasks/:id
è·å–å•ä¸ªä»»åŠ¡è¯¦æƒ…

### POST /api/tasks
åˆ›å»ºæ–°ä»»åŠ¡

**è¯·æ±‚ä½“:**
```json
{
  "title": "æ–°ä»»åŠ¡æ ‡é¢˜",
  "status": "å¾…è·Ÿè¿›"  // å¯é€‰
}
```

### PATCH /api/tasks/:id
æ›´æ–°ä»»åŠ¡

**è¯·æ±‚ä½“:**
```json
{
  "title": "æ›´æ–°åçš„æ ‡é¢˜",  // å¯é€‰
  "status": "å·²è§£å†³"        // å¯é€‰
}
```

## æŠ€æœ¯æ ˆ

- **å‰ç«¯**: Vite + React + TypeScript
- **åç«¯**: Node.js + Express + TypeScript
- **æ•°æ®åº“**: Notion API
- **å¼€å‘å·¥å…·**: concurrently, tsx

## æ•…éšœæ’é™¤

### âŒ 401 Unauthorized - API token is invalid

è¿™æ˜¯æœ€å¸¸è§çš„é—®é¢˜ï¼Œé€šå¸¸æ˜¯å› ä¸ºï¼š

**1. Token æ ¼å¼é”™è¯¯æˆ–æ¥æºä¸å¯¹**
   - âœ… **æ­£ç¡®**: ä½¿ç”¨ Integration çš„ "Internal Integration Secret" (https://www.notion.so/my-integrations)
   - âŒ **é”™è¯¯**: ä½¿ç”¨ä¸ªäººè´¦æˆ·çš„ API Key æˆ–å…¶ä»– token
   - Token å¿…é¡»ä»¥ `secret_` å¼€å¤´ï¼Œé•¿åº¦çº¦ 50 å­—ç¬¦

**2. ç¯å¢ƒå˜é‡æœªæ­£ç¡®åŠ è½½**
   ```bash
   # æ£€æŸ¥ server/.env æ–‡ä»¶æ˜¯å¦å­˜åœ¨
   ls -la server/.env
   
   # æŸ¥çœ‹æœåŠ¡å™¨å¯åŠ¨æ—¥å¿—ï¼Œç¡®è®¤ token å·²åŠ è½½
   # åº”è¯¥çœ‹åˆ°ï¼šğŸ”‘ NOTION_TOKEN loaded: length=50, prefix=secret_xxx...
   ```

**3. éªŒè¯ Token æœ‰æ•ˆæ€§**
   ```bash
   # å¯åŠ¨æœåŠ¡å™¨åï¼Œè®¿é—®è°ƒè¯•ç«¯ç‚¹
   curl http://localhost:3001/api/debug/notion-auth
   
   # æˆ–åœ¨æµè§ˆå™¨æ‰“å¼€
   http://localhost:3001/api/debug/notion-auth
   ```

**ä¿®å¤æ­¥éª¤ï¼š**
1. è®¿é—® https://www.notion.so/my-integrations
2. è¿›å…¥ä½ çš„ Integration
3. ç‚¹å‡» "Show" â†’ "Copy" Internal Integration Secret
4. æ‰“å¼€ `server/.env`ï¼Œç¡®ä¿æ ¼å¼æ­£ç¡®ï¼š
   ```env
   NOTION_TOKEN=secret_your_actual_token_here
   NOTION_DATABASE_ID=your_database_id_here
   ```
5. é‡å¯æœåŠ¡å™¨ï¼š`npm run dev`
6. å†æ¬¡è®¿é—® `/api/debug/notion-auth` éªŒè¯

### âŒ 403 Forbidden - Database not found

**åŸå› **: æ•°æ®åº“æœªåˆ†äº«ç»™ Integration

**ä¿®å¤æ­¥éª¤ï¼š**
1. æ‰“å¼€ Notion æ•°æ®åº“é¡µé¢
2. ç‚¹å‡»å³ä¸Šè§’ "..." â†’ "Add connections"
3. é€‰æ‹©ä½ çš„ Integration
4. ç‚¹å‡» "Confirm"

### åç«¯å¯åŠ¨å¤±è´¥
- ç¡®è®¤ `server/.env` æ–‡ä»¶å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
- æ£€æŸ¥ NOTION_TOKEN å’Œ NOTION_DATABASE_ID æ˜¯å¦æœ‰æ•ˆ
- ç¡®ä¿ç«¯å£ 3001 æœªè¢«å ç”¨

### å‰ç«¯æ— æ³•è·å–æ•°æ®
- ç¡®è®¤åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆ`http://localhost:3001/health` åº”è¿”å› `{"status":"ok"}`ï¼‰
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ CORS é”™è¯¯
- æ£€æŸ¥ Vite proxy é…ç½®æ˜¯å¦æ­£ç¡®

### Notion API é”™è¯¯
- ç¡®è®¤ Integration å·²åˆ†äº«ç»™ç›®æ ‡æ•°æ®åº“
- æ£€æŸ¥æ•°æ®åº“å±æ€§åç§°æ˜¯å¦ä¸º `æ ‡é¢˜` å’Œ `çŠ¶æ€`
- æ£€æŸ¥çŠ¶æ€å€¼æ˜¯å¦ä¸ºå…è®¸çš„ 5 ä¸ªå€¼ä¹‹ä¸€ï¼š`å¾…è·Ÿè¿›`, `è®¡åˆ’ä¸­`, `ä¸¢å¼ƒ`, `æç½®`, `å·²è§£å†³`
- **æ³¨æ„**: åˆ†ç»„æ ‡é¢˜ï¼ˆ"å¾…åŠ"ã€"è¿›è¡Œä¸­"ã€"å·²å®Œæˆ"ï¼‰ä¸æ˜¯å®é™…çŠ¶æ€å€¼ï¼Œä¸è¦å†™å…¥æ•°æ®åº“

## è®¸å¯è¯

MIT
